# **1. 프로젝트 목표**
*   AI 기반의 구독형 사주풀이 웹 서비스 구현
*   가입 회원이 AI가 생성한 사주 분석 결과를 조회하고, 저장 및 관리할 수 있는 플랫폼 제공

# **2. 기술 스택 및 외부 서비스**
*   **인증 및 회원 관리:** Clerk (구글 소셜 로그인 포함)
*   **결제 시스템:** 토스페이먼츠 (구독 결제)
*   **데이터베이스 및 백엔드:** Supabase
*   **정기 결제 트리거:** Supabase Cron
*   **AI 모델:** Google Gemini API (gemini-2.5-flash, gemini-2.5-pro)

# **3. 핵심 기능 명세**

## **AI 사주 분석**
*   **입력 정보:** 이름, 성별, 생년월일(양력/음력), 태어난 시간
*   **사주 데이터 전처리:**
    *   사용자 입력 정보를 사주팔자(만세력) 데이터(간지, 십신, 대운 등)로 변환하는 서버 로직을 구현합니다.
    *   이 검증된 데이터를 기반으로 Gemini API에 정교한 프롬프트(Prompt)를 전송하여 분석 결과의 정확성과 일관성을 확보합니다.
*   **분석 종류 (사용자 선택):** 월간 운세, 신년 운세, 평생 운세
*   **결과 제공:** 특정 카테고리에 치우치지 않는 종합적인 운세 풀이를 제공합니다.
*   **결과 데이터 구조화:**
    *   AI가 생성하는 결과는 `{"general": "총운 내용", "wealth": "재물운 내용", "love": "애정운 내용" ...}` 과 같이 명확한 JSON 스키마를 따르도록 프롬프트를 설계하여, 프론트엔드에서 안정적으로 데이터를 처리하도록 합니다.
*   **결과 저장:** 분석 결과는 생성과 동시에 Supabase DB에 JSON 형식으로 자동 저장됩니다.

## **구독 정책 및 사용자 등급**
*   **무료 사용자:**
    *   최초 가입 시 3회의 사주 분석 기회 제공
    *   AI 모델: `gemini-2.5-flash` 사용
*   **Pro 요금제 (유료 구독자):**
    *   월 10회의 사주 분석 기회 제공
    *   AI 모델: `gemini-2.5-pro`를 사용하여 더 높은 품질의 분석 결과 제공
*   **사용량 관리 및 이월 정책:**
    *   **사용량 차감:** AI의 분석 결과가 성공적으로 생성된 시점에 횟수가 차감됩니다. (API 호출 실패 등 오류 발생 시에는 차감되지 않음)
    *   **잔여 횟수 알림:** 남은 분석 횟수가 3회 이하일 때, '새 분석하기' 페이지 진입 시 사용자에게 팝업 또는 알림창으로 잔여 횟수를 안내합니다.
    *   **크레딧 이월 불가 정책:** 월간 제공 횟수는 매월 결제일에 초기화되며, 사용하지 않은 횟수는 다음 달로 이월되지 않습니다. 이 내용은 구독 결제 및 관리 페이지에 명확하게 고지합니다.

## **구독 및 결제 관리**
*   **구독 취소:**
    *   사용자가 구독을 취소하면, '취소 예정' 상태로 변경되며 다음 결제일까지 구독 혜택이 유지됩니다.
    *   '취소 예정' 상태에서는 언제든지 구독 취소를 철회하고 다시 활성화할 수 있습니다.
*   **구독 만료:**
    *   최종 결제일이 지나 구독이 완전히 만료되면, 토스페이먼츠의 빌링키를 삭제합니다.
    *   재구독을 원하는 경우, SDK를 통해 새로운 빌링키를 발급받아 결제를 진행합니다.

## **대상 인물 관리 (프로필 기능)**
*   사용자는 본인 외 가족, 친구 등 자주 보는 사람의 정보(이름, 성별, 생년월일시)를 프로필로 저장하고 관리할 수 있습니다.
*   '새 분석하기' 페이지에서 저장된 프로필을 선택하여 간편하게 정보를 입력할 수 있습니다.

# **4. 페이지별 상세 기능**

## **공통 사항**
*   홈(랜딩 페이지)을 제외한 모든 페이지는 Clerk를 통한 인증된 사용자만 접근 가능합니다.
*   로그인, 회원가입, 마이페이지 등 인증 관련 UI는 Clerk에서 기본 제공하는 컴포넌트를 활용합니다.

## **홈 (랜딩 페이지)**
*   **디자인:** 토스 페이먼츠 웹사이트의 깔끔하고 현대적인 디자인을 벤치마킹합니다.
*   **헤더 구성:**
    *   미로그인 시: 서비스 로고, 로그인/회원가입 버튼
    *   로그인 시: 서비스 로고, 분석 목록 / 새 분석하기 / 구독 관리 메뉴, 사용자 프로필(클릭 시 정보 수정, 로그아웃, 회원 탈퇴)

## **대시보드 (분석 목록)**
*   **기능:** 사용자가 기존에 분석한 모든 사주풀이 내역을 확인하는 공간입니다.
*   **UI:** 분석 대상의 이름, 분석 종류(신년/월간 등), 분석 날짜를 리스트 형태로 표시하며, 한 페이지에 10개씩 페이지네이션을 적용합니다.
*   **편의 기능:**
    *   **검색:** 분석 대상의 이름으로 과거 내역을 검색하는 기능
    *   **필터:** 분석 종류(평생, 신년 등)별로 필터링하는 기능
    *   **삭제:** 사용자가 원치 않는 분석 내역을 직접 삭제하는 기능
*   **상세 기능:** 목록의 각 항목을 클릭하면 해당 '분석 상세보기' 페이지로 이동하여 과거 내역 조회, 프린트, PDF 다운로드 기능을 제공합니다.

## **새 분석하기**
*   **기능:** 새로운 사주 분석을 시작하는 페이지입니다.
*   **입력 폼:**
    *   **'새로 입력하기' 탭:** 이름, 성별, 생년월일시를 직접 입력합니다.
    *   **'불러오기' 탭:** 저장된 '대상 인물(프로필)' 목록에서 선택하여 정보를 자동 입력합니다.
*   **프로세스:**
    *   정보 입력 후 '분석 시작' 버튼을 누르면, 로딩 애니메이션과 함께 "운명을 해석하고 있습니다..."와 같은 대기 메시지를 표시합니다.
    *   분석이 완료되면 '분석 상세보기' 페이지로 자동 이동합니다.

## **분석 상세보기**
*   **기능:** AI가 생성한 사주 분석 결과를 사용자에게 보여주는 페이지입니다.
*   **UI/UX:**
    *   분석 결과를 주제별(예: 총운, 재물운, 애정운 등)로 나누어 카드 형태로 표시합니다.
    *   각 카드의 내용에 어울리는 이모지(emoji)를 적절히 사용하여 가독성과 시각적 만족도를 향상시킵니다.
*   **부가 기능:**
    *   **PDF로 저장하기:** 현재 보고 있는 상세 보기 페이지의 디자인과 동일한 형태의 PDF 파일로 다운로드 기능을 제공합니다.
    *   **공유하기:** 카카오톡 또는 링크 복사를 통해 분석 결과를 지인에게 공유하는 기능을 제공합니다.

## **구독 관리**
*   **기능:** 구독 상품 정보 확인, Pro 요금제 결제 및 해지 관리
*   **표시 정보:** 현재 사용자의 구독 상태(무료, Pro, 취소 예정), 월간 분석 횟수 제공량 및 남은 횟수, 다음 결제 예정일 등을 표시합니다.
*   **구독/해지:** 상기 '구독 정책'에 명시된 프로세스에 따라 기능을 구현합니다.